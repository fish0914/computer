<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éœ“è™¹è²ªåƒè›‡ HTMLç‰ˆ</title>
    <!-- å¼•å…¥ Tailwind CSS ä»¥ä¿æŒæ¨£å¼ç¾è§€ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªå®šç¾©éœ“è™¹å…‰æšˆæ•ˆæœ */
        .neon-shadow {
            box-shadow: 0 0 10px rgba(74, 222, 128, 0.8);
        }
        .food-shadow {
            box-shadow: 0 0 10px rgba(236, 72, 153, 0.8);
        }
        .border-glow {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }
        /* é˜²æ­¢æ‰‹æ©Ÿé›™æ“Šç¸®æ”¾ */
        body {
            touch-action: manipulation;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-900 text-white flex flex-col items-center justify-center p-4 font-mono select-none">

    <!-- åˆ†æ•¸æ¿ -->
    <div class="w-full max-w-md mb-4 flex justify-between items-end">
        <div>
            <h1 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500 mb-1">
                NEON SNAKE
            </h1>
            <div class="flex items-center text-sm text-gray-400">
                <span class="mr-1 text-yellow-500">ğŸ†</span>
                æœ€é«˜åˆ†: <span id="highScore">0</span>
            </div>
        </div>
        <div class="text-right">
            <div id="score" class="text-4xl font-bold text-green-400">0</div>
            <div class="text-xs text-gray-500">SCORE</div>
        </div>
    </div>

    <!-- éŠæˆ²ä¸»å€åŸŸ -->
    <div class="relative group">
        <!-- èƒŒæ™¯å…‰æšˆ -->
        <div id="glow-bg" class="absolute -inset-1 bg-gradient-to-r from-green-600 to-blue-600 rounded-lg blur opacity-25 transition duration-1000"></div>
        
        <!-- ç•«å¸ƒå®¹å™¨ -->
        <div class="relative bg-gray-800 border-2 border-gray-700 rounded-lg shadow-2xl overflow-hidden" 
             style="width: min(90vw, 400px); height: min(90vw, 400px);">
            
            <!-- éŠæˆ²ç•«å¸ƒ -->
            <canvas id="gameCanvas" width="400" height="400" class="block w-full h-full"></canvas>

            <!-- é®ç½©å±¤ (é–‹å§‹/æš«åœ/çµæŸ) -->
            <div id="overlay" class="absolute inset-0 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center z-30 text-center p-4">
                <h2 id="overlayTitle" class="text-3xl font-bold text-white mb-6">æº–å‚™å¥½äº†å—ï¼Ÿ</h2>
                <div id="overlayDesc" class="flex flex-col gap-2 mb-6 text-sm text-gray-400">
                    <p>é›»è…¦: æ–¹å‘éµç§»å‹•, ç©ºç™½éµæš«åœ</p>
                    <p>æ‰‹æ©Ÿ: ä½¿ç”¨ä¸‹æ–¹æŒ‰éˆ•</p>
                </div>
                <button id="actionBtn" class="flex items-center gap-2 px-8 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-full font-bold transition transform hover:scale-105 shadow-lg active:scale-95">
                    é–‹å§‹éŠæˆ²
                </button>
            </div>
        </div>
    </div>

    <!-- æ§åˆ¶å€ -->
    <div class="w-full max-w-md mt-6 flex justify-between items-center px-2">
        
        <!-- å·¦å´åŠŸèƒ½éµ -->
        <div class="flex gap-4">
            <button id="pauseBtn" class="p-3 bg-gray-800 rounded-full text-gray-400 hover:text-white hover:bg-gray-700 transition disabled:opacity-30">
                <!-- æš«åœåœ–ç¤º (SVG) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
            </button>
            
            <button id="resetBtn" class="p-3 bg-gray-800 rounded-full text-gray-400 hover:text-red-400 hover:bg-gray-700 transition disabled:opacity-30">
                <!-- é‡ç½®åœ–ç¤º (SVG) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
            </button>
        </div>

        <!-- è™›æ“¬æ–¹å‘éµ -->
        <div class="grid grid-cols-3 gap-1">
            <div></div>
            <button class="d-btn w-14 h-14 bg-gray-800 rounded-lg flex items-center justify-center active:bg-blue-600 active:scale-95 transition shadow-md border-b-4 border-gray-900 active:border-b-0 active:translate-y-1" data-dir="UP">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
            </button>
            <div></div>
            
            <button class="d-btn w-14 h-14 bg-gray-800 rounded-lg flex items-center justify-center active:bg-blue-600 active:scale-95 transition shadow-md border-b-4 border-gray-900 active:border-b-0 active:translate-y-1" data-dir="LEFT">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
            </button>
            
            <button class="d-btn w-14 h-14 bg-gray-800 rounded-lg flex items-center justify-center active:bg-blue-600 active:scale-95 transition shadow-md border-b-4 border-gray-900 active:border-b-0 active:translate-y-1" data-dir="DOWN">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
            </button>
            
            <button class="d-btn w-14 h-14 bg-gray-800 rounded-lg flex items-center justify-center active:bg-blue-600 active:scale-95 transition shadow-md border-b-4 border-gray-900 active:border-b-0 active:translate-y-1" data-dir="RIGHT">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
            </button>
        </div>
    </div>
    
    <div class="mt-4 text-xs text-gray-600">
        Tips: é›»è…¦æŒ‰ç©ºç™½éµæš«åœï¼Œæ‰‹æ©Ÿé»æ“Šå·¦ä¸‹è§’æŒ‰éˆ•ã€‚
    </div>

    <script>
        // --- éŠæˆ²å¸¸æ•¸èˆ‡è®Šæ•¸ ---
        const GRID_SIZE = 20;
        const TILE_COUNT = 20; // 20x20 ç¶²æ ¼
        const CANVAS_SIZE = 400;
        const TILE_SIZE = CANVAS_SIZE / TILE_COUNT;
        
        const INITIAL_SPEED = 150;
        const MIN_SPEED = 60;
        const SPEED_INCREMENT = 2;

        const DIRECTIONS = {
            UP: { x: 0, y: -1 },
            DOWN: { x: 0, y: 1 },
            LEFT: { x: -1, y: 0 },
            RIGHT: { x: 1, y: 0 },
        };

        // DOM å…ƒç´ 
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const highScoreEl = document.getElementById('highScore');
        const overlay = document.getElementById('overlay');
        const overlayTitle = document.getElementById('overlayTitle');
        const overlayDesc = document.getElementById('overlayDesc');
        const actionBtn = document.getElementById('actionBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const glowBg = document.getElementById('glow-bg');

        // éŠæˆ²ç‹€æ…‹
        let snake = [];
        let food = {};
        let direction = DIRECTIONS.RIGHT;
        let nextDirection = DIRECTIONS.RIGHT;
        let score = 0;
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        let speed = INITIAL_SPEED;
        let gameLoopId = null;
        let isGameRunning = false;
        let isPaused = false;
        let isGameOver = false;

        // åˆå§‹åŒ–é¡¯ç¤º
        highScoreEl.textContent = highScore;

        // --- æ ¸å¿ƒåŠŸèƒ½ ---

        function initGame() {
            snake = [{ x: 10, y: 10 }];
            generateFood();
            direction = DIRECTIONS.RIGHT;
            nextDirection = DIRECTIONS.RIGHT;
            score = 0;
            speed = INITIAL_SPEED;
            isGameOver = false;
            isPaused = false;
            isGameRunning = true;
            
            scoreEl.textContent = score;
            updateOverlay(false); // éš±è—é®ç½©
            updateGlow(false);    // æ­£å¸¸å…‰æšˆ

            if (gameLoopId) clearTimeout(gameLoopId);
            gameLoop();
        }

        function generateFood() {
            let newFood;
            let isOnSnake;
            do {
                newFood = {
                    x: Math.floor(Math.random() * TILE_COUNT),
                    y: Math.floor(Math.random() * TILE_COUNT)
                };
                isOnSnake = snake.some(segment => segment.x === newFood.x && segment.y === newFood.y);
            } while (isOnSnake);
            food = newFood;
        }

        function update() {
            if (isPaused || isGameOver) return;

            // æ›´æ–°æ–¹å‘
            direction = nextDirection;
            
            const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };

            // 1. æ’ç‰†æª¢æ¸¬
            if (head.x < 0 || head.x >= TILE_COUNT || head.y < 0 || head.y >= TILE_COUNT) {
                gameOver();
                return;
            }

            // 2. æ’è‡ªå·±æª¢æ¸¬
            if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                gameOver();
                return;
            }

            // ç§»å‹•è›‡é ­
            snake.unshift(head);

            // 3. åƒé£Ÿç‰©æª¢æ¸¬
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                scoreEl.textContent = score;
                
                if (score > highScore) {
                    highScore = score;
                    highScoreEl.textContent = highScore;
                    localStorage.setItem('snakeHighScore', highScore);
                }

                // åŠ é€Ÿ
                speed = Math.max(MIN_SPEED, speed - SPEED_INCREMENT);
                
                generateFood();
            } else {
                // æ²’åƒåˆ°ï¼Œç§»é™¤è›‡å°¾
                snake.pop();
            }
        }

        function draw() {
            // æ¸…ç©ºç•«å¸ƒ
            ctx.fillStyle = '#1f2937'; // gray-800
            ctx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

            // ç•«ç¶²æ ¼ (æ·¡æ·¡çš„)
            ctx.strokeStyle = '#374151'; // gray-700
            ctx.lineWidth = 1;
            /* // æ•ˆèƒ½è€ƒé‡ï¼Œå¦‚æœè¦ºå¾—å¡å¯ä»¥è¨»è§£æ‰ç¶²æ ¼ç¹ªè£½
            for (let x = 0; x <= CANVAS_SIZE; x += TILE_SIZE) {
                ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, CANVAS_SIZE); ctx.stroke();
            }
            for (let y = 0; y <= CANVAS_SIZE; y += TILE_SIZE) {
                ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(CANVAS_SIZE, y); ctx.stroke();
            }
            */

            // ç•«è›‡
            snake.forEach((segment, index) => {
                const x = segment.x * TILE_SIZE;
                const y = segment.y * TILE_SIZE;

                // è›‡é ­
                if (index === 0) {
                    ctx.fillStyle = isGameOver ? '#ef4444' : '#4ade80'; // red-500 : green-400
                    // å¢åŠ å…‰æšˆæ•ˆæœ
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = isGameOver ? '#ef4444' : '#4ade80';
                } else {
                    ctx.fillStyle = isGameOver ? '#b91c1c' : '#16a34a'; // red-700 : green-600
                    ctx.shadowBlur = 0;
                }

                // ç¹ªè£½åœ“è§’çŸ©å½¢ (ç¨å¾®ç¸®å°ä¸€é»ç”¢ç”Ÿé–“éš”æ„Ÿ)
                ctx.fillRect(x + 1, y + 1, TILE_SIZE - 2, TILE_SIZE - 2);
                
                // ç•«çœ¼ç› (åƒ…é ­éƒ¨)
                if (index === 0 && !isGameOver) {
                    ctx.shadowBlur = 0; // çœ¼ç›ä¸è¦ç™¼å…‰
                    ctx.fillStyle = 'black';
                    const eyeSize = TILE_SIZE / 5;
                    // ç°¡å–®è™•ç†ï¼šæ ¹æ“šå¤§è‡´ä½ç½®ç•«å…©éš»çœ¼
                    ctx.fillRect(x + TILE_SIZE*0.2, y + TILE_SIZE*0.2, eyeSize, eyeSize);
                    ctx.fillRect(x + TILE_SIZE*0.6, y + TILE_SIZE*0.2, eyeSize, eyeSize);
                }
            });

            // ç•«é£Ÿç‰©
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#ec4899'; // pink-500
            ctx.fillStyle = '#ec4899';
            const fx = food.x * TILE_SIZE + TILE_SIZE/2;
            const fy = food.y * TILE_SIZE + TILE_SIZE/2;
            
            ctx.beginPath();
            ctx.arc(fx, fy, TILE_SIZE/2 - 4, 0, Math.PI * 2);
            ctx.fill();

            // é‡ç½®é™°å½±
            ctx.shadowBlur = 0;
        }

        function gameLoop() {
            update();
            draw();
            if (isGameRunning && !isGameOver) {
                gameLoopId = setTimeout(gameLoop, speed);
            }
        }

        function gameOver() {
            isGameOver = true;
            isGameRunning = false;
            updateGlow(true); // ç´…è‰²å…‰æšˆ
            
            // é¡¯ç¤º Game Over ç•«é¢
            overlayTitle.textContent = "GAME OVER";
            overlayTitle.classList.add('text-red-500');
            overlayDesc.innerHTML = `<p class="text-xl text-white">æœ€çµ‚å¾—åˆ†: ${score}</p>`;
            actionBtn.textContent = "å†ç©ä¸€æ¬¡";
            actionBtn.className = "flex items-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-500 text-white rounded-full font-bold transition transform hover:scale-105 shadow-lg active:scale-95";
            
            overlay.classList.remove('hidden');
        }

        function togglePause() {
            if (!isGameRunning || isGameOver) return;
            
            isPaused = !isPaused;
            if (isPaused) {
                overlayTitle.textContent = "æš«åœä¸­";
                overlayTitle.classList.remove('text-red-500');
                overlayDesc.innerHTML = "";
                actionBtn.textContent = "ç¹¼çºŒ";
                actionBtn.className = "flex items-center gap-2 px-8 py-3 bg-yellow-600 hover:bg-yellow-500 text-white rounded-full font-bold transition transform hover:scale-105 shadow-lg active:scale-95";
                overlay.classList.remove('hidden');
                clearTimeout(gameLoopId); // åœæ­¢è¨ˆæ™‚å™¨
            } else {
                overlay.classList.add('hidden');
                gameLoop(); // é‡æ–°å•Ÿå‹•
            }
        }

        // --- è¼”åŠ© UI æ›´æ–° ---
        
        function updateOverlay(show) {
            if (!show) {
                overlay.classList.add('hidden');
            } else {
                overlay.classList.remove('hidden');
            }
        }

        function updateGlow(isError) {
            if (isError) {
                glowBg.className = "absolute -inset-1 bg-gradient-to-r from-red-600 to-orange-600 rounded-lg blur opacity-75 transition duration-1000";
            } else {
                glowBg.className = "absolute -inset-1 bg-gradient-to-r from-green-600 to-blue-600 rounded-lg blur opacity-25 transition duration-1000";
            }
        }

        // --- äº‹ä»¶ç›£è½ ---

        // éµç›¤æ§åˆ¶
        document.addEventListener('keydown', (e) => {
            // é˜²æ­¢ç©ºç™½éµå’Œæ–¹å‘éµæ²å‹•ç¶²é 
            if(['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
                e.preventDefault();
            }

            if (e.key === ' ') {
                if (!isGameRunning && !isGameOver) {
                    initGame(); // é¦–é æŒ‰ç©ºç™½éµé–‹å§‹
                } else {
                    togglePause();
                }
                return;
            }

            if (!isGameRunning || isPaused) return;

            switch(e.key) {
                case 'ArrowUp':
                    if (direction.y !== 1) nextDirection = DIRECTIONS.UP;
                    break;
                case 'ArrowDown':
                    if (direction.y !== -1) nextDirection = DIRECTIONS.DOWN;
                    break;
                case 'ArrowLeft':
                    if (direction.x !== 1) nextDirection = DIRECTIONS.LEFT;
                    break;
                case 'ArrowRight':
                    if (direction.x !== -1) nextDirection = DIRECTIONS.RIGHT;
                    break;
            }
        });

        // æŒ‰éˆ•æ§åˆ¶
        actionBtn.addEventListener('click', () => {
            if (isGameOver || !isGameRunning) {
                // é‡è¨­æ¨™é¡Œæ¨£å¼
                overlayTitle.classList.remove('text-red-500');
                initGame();
            } else if (isPaused) {
                togglePause();
            }
        });

        pauseBtn.addEventListener('click', togglePause);
        
        resetBtn.addEventListener('click', () => {
            if (confirm("ç¢ºå®šè¦é‡æ–°é–‹å§‹å—ï¼Ÿ")) {
                initGame();
            }
        });

        // è™›æ“¬æ–¹å‘éµ
        document.querySelectorAll('.d-btn').forEach(btn => {
            btn.addEventListener('pointerdown', (e) => {
                e.preventDefault(); // é˜²æ­¢é›™æ“Šé¸å–
                if (!isGameRunning || isPaused) return;
                
                const dir = btn.dataset.dir;
                switch(dir) {
                    case 'UP':
                        if (direction.y !== 1) nextDirection = DIRECTIONS.UP;
                        break;
                    case 'DOWN':
                        if (direction.y !== -1) nextDirection = DIRECTIONS.DOWN;
                        break;
                    case 'LEFT':
                        if (direction.x !== 1) nextDirection = DIRECTIONS.LEFT;
                        break;
                    case 'RIGHT':
                        if (direction.x !== -1) nextDirection = DIRECTIONS.RIGHT;
                        break;
                }
            });
        });

        // åˆå§‹ç¹ªè£½ä¸€æ¬¡ç•«é¢ (é¡¯ç¤ºç¶²æ ¼)
        draw();

    </script>
</body>
</html>
